<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>output.bmp — viewer</title>
  <style>
    /* Very simple, no roundings, everything centered, dark mode */
    :root{--bg:#0b0c0d;--fg:#e6e6e6;--muted:#9aa0a6;--panel:#141516}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .no-rounding *{border-radius:0 !important}
    .container{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:16px;box-sizing:border-box}
    img{display:block;max-width:100%;max-height:calc(100% - 72px);object-fit:contain;image-rendering:auto}
    .controls{display:flex;align-items:center;gap:12px}
    button{background:var(--panel);color:var(--fg);border:1px solid #222;padding:8px 12px;font-size:1rem;cursor:pointer}
    label{color:var(--muted);font-size:0.95rem;user-select:none}
    a{color:var(--fg)}
  </style>
</head>
<body class="no-rounding">
  <div class="container">
    <img id="img" src="output.bmp" alt="output.bmp">
    <div class="controls">
      <button id="reload">Reload now</button>
      <label><input id="autorefresh" type="checkbox" checked> Auto-refresh</label>
      <label style="margin-left:8px;color:var(--muted);font-size:0.9rem">Interval: <input id="interval" type="number" min="200" value="200" style="width:84px;background:transparent;border:1px solid #222;color:var(--fg);padding:4px;margin-left:6px"></label>
    </div>
  </div>

  <script>
    // Configuration
    const imgEl = document.getElementById('img');
    const reloadBtn = document.getElementById('reload');
    const autoCheckbox = document.getElementById('autorefresh');
    const intervalInput = document.getElementById('interval');

    // Default interval in ms (can be changed by user input)
    let intervalMs = Number(intervalInput.value) || 200;
    let timer = null;

    // Force image reload and bust caches by appending a timestamp query param
    function refreshImage() {
      // Keep the original filename so it can be replaced in the filesystem by your generator
      const url = 'output.bmp' + '?ts=' + Date.now();
      imgEl.src = url;
    }

    function startAutoRefresh() {
      stopAutoRefresh();
      timer = setInterval(()=>{ if (!document.hidden) refreshImage(); }, intervalMs);
    }
    function stopAutoRefresh(){ if (timer){ clearInterval(timer); timer = null; } }

    // UI wiring
    reloadBtn.addEventListener('click', ()=> refreshImage());
    autoCheckbox.addEventListener('change', ()=> { if (autoCheckbox.checked) startAutoRefresh(); else stopAutoRefresh(); });
    intervalInput.addEventListener('change', ()=>{
      const v = Number(intervalInput.value) || 200;
      intervalMs = Math.max(200, v);
      if (autoCheckbox.checked) startAutoRefresh();
    });

    // Refresh immediately when page becomes visible again
    document.addEventListener('visibilitychange', ()=>{ if (!document.hidden) refreshImage(); });

    // Initial load
    window.addEventListener('load', ()=>{
      refreshImage();
      if (autoCheckbox.checked) startAutoRefresh();
    });

    // Optional: small error handling (no visual change to keep UI minimal)
    imgEl.addEventListener('error', ()=>{ console.debug('Failed to load output.bmp — file may not exist yet or generator not running.'); });
  </script>
</body>
</html>
